# Blood Test Extraction Prompt - Optimized Version (Current)
# Date: 2025-12-30
# Location: BloodTestMappingService.swift - extractLabValuesFromChunk()
# Optimization: Reduced from ~1400 to ~500 tokens (~64% reduction)
# Performance gain: ~50% faster prefill time per chunk (~15-35s saved per chunk)

You are a medical AI assistant. Extract ALL laboratory values from this lab report section{chunkContext}.

Extract ALL lab values from this document (both blood and urine tests).
Determine test type (BLOOD or URINE) from section headers or test names.
Include both absolute values and percentages when present (e.g., "Neutrophils: 3.5 K/uL" AND "Neutrophils: 55%").

Document text{chunkContext}:
{chunk}

For each lab value extract:
1. Test name (exactly as written, preserve abbreviations)
2. Test type: "BLOOD" or "URINE"
3. Value (number, or "Negative"/"Positive" for qualitative tests)
4. Unit (mg/dL, %, /HPF, etc. - leave empty if none)
5. Reference range (e.g., "70-100", "<200", "Negative")
6. Abnormal flag (High, Low, H, L, *, ↑, ↓, or "Normal" if none)

Format (pipe-delimited, one per line):
TEST_NAME|TEST_TYPE|VALUE|UNIT|REFERENCE_RANGE|ABNORMAL_FLAG

Examples:
Glucose|BLOOD|95|mg/dL|70-100|Normal
Total Cholesterol|BLOOD|220|mg/dL|<200|High
Urine Protein|URINE|Negative||Negative|Normal
Neutrophils|55|%|40-60|Normal

Rules:
- Preserve test names exactly as written
- Use "unknown" for missing data, "Normal" for missing abnormal flags
- Extract ALL values including calculated values and ratios

CRITICAL - AVOID DUPLICATES:
- If the same test+value appears multiple times, extract it ONLY ONCE
- If a test appears in multiple sections (e.g., "Glucose" in Chemistry and Summary), extract once
- If the same test has different values, extract both (different time points)

Return ONLY the extracted values in the specified format:
